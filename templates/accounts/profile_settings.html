{% extends 'base/base.html' %} {% block title %}Paramètres du profil - Linkedong{% endblock %} {% block extra_css %}
<style>
    .settings-container {
        min-height: 100vh;
        background: #f8f9fa;
        padding: 2rem 0;
    }

    .settings-card {
        background: white;
        border-radius: 1rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }

    .settings-header {
        background: linear-gradient(135deg, var(--linkedin-blue) 0%, var(--linkedin-dark-blue) 100%);
        color: white;
        padding: 2rem;
        text-align: center;
    }

    .settings-body {
        padding: 2rem;
    }

    .profile-preview {
        background: #f8f9fa;
        border-radius: 0.5rem;
        padding: 1.5rem;
        margin-bottom: 2rem;
        border: 2px dashed #dee2e6;
    }

    .profile-picture-preview {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid white;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .cover-picture-preview {
        width: 100%;
        height: 120px;
        border-radius: 0.5rem;
        object-fit: cover;
        margin-bottom: 1rem;
    }

    .section-title {
        color: var(--linkedin-blue);
        font-weight: 600;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #e9ecef;
    }

    .form-section {
        margin-bottom: 2rem;
    }

    /* Styles pour les photos */
    .current-photo-container {
        text-align: center;
    }

    .current-profile-pic {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #e9ecef;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .current-cover-pic {
        width: 100%;
        height: 80px;
        border-radius: 0.5rem;
        object-fit: cover;
        border: 2px solid #e9ecef;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .preview-profile-pic {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid var(--linkedin-blue);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .preview-cover-pic {
        width: 100%;
        height: 60px;
        border-radius: 0.5rem;
        object-fit: cover;
        border: 2px solid var(--linkedin-blue);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    /* Masquer l'input file par défaut */
    input[type="file"] {
        display: none;
    }

    /* Style pour l'input group */
    .input-group .btn {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
    }
</style>
{% endblock %} {% block content %}
<div class="settings-container">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="settings-card">
                    <div class="settings-header">
                        <h2 class="mb-2"><i class="fas fa-user-cog me-2"></i>Paramètres du profil</h2>
                        <p class="mb-0">Gérez vos informations personnelles et votre compte</p>
                    </div>

                    <div class="settings-body">
                        <!-- Aperçu du profil -->
                        <div class="profile-preview">
                            <h6 class="text-muted mb-3"><i class="fas fa-eye me-2"></i>Aperçu de votre profil</h6>
                            <div class="row align-items-center">
                                <div class="col-auto">
                                    {% if user.profile.profile_picture %}
                                    <img
                                        src="{{ user.profile.profile_picture.url }}"
                                        alt="Photo de profil"
                                        class="profile-picture-preview"
                                    />
                                    {% else %}
                                    <div
                                        class="profile-picture-preview bg-secondary d-flex align-items-center justify-content-center text-white fw-bold"
                                    >
                                        {{ user.first_name|first|upper }}{{ user.last_name|first|upper }}
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="col">
                                    <h5 class="mb-1">{{ user.first_name }} {{ user.last_name }}</h5>
                                    <p class="text-muted mb-1">{{ user.email }}</p>
                                </div>
                            </div>
                        </div>

                        <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
                            {% csrf_token %}

                            <!-- Messages d'erreur généraux -->
                            {% if form.non_field_errors %}
                            <div class="alert alert-danger mb-3">
                                {% for error in form.non_field_errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                            {% endif %}

                            <!-- Informations personnelles -->
                            <div class="form-section">
                                <h5 class="section-title"><i class="fas fa-user me-2"></i>Informations personnelles</h5>

                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                                                                         {{ form.first_name }}
                                             <label for="{{ form.first_name.id_for_label }}">Prénom</label>
                                             {% if form.first_name.errors %}
                                                 {% for error in form.first_name.errors %}
                                                     <div class="text-danger small mt-1">{{ error }}</div>
                                                 {% endfor %}
                                             {% endif %}
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                                                                         {{ form.last_name }}
                                             <label for="{{ form.last_name.id_for_label }}">Nom</label>
                                             {% if form.last_name.errors %}
                                                 {% for error in form.last_name.errors %}
                                                     <div class="text-danger small mt-1">{{ error }}</div>
                                                 {% endfor %}
                                             {% endif %}
                                        </div>
                                    </div>
                                </div>

                                <div class="form-floating mt-3">
                                                                         {{ form.email }}
                                     <label for="{{ form.email.id_for_label }}">Email</label>
                                     {% if form.email.errors %}
                                         {% for error in form.email.errors %}
                                             <div class="text-danger small mt-1">{{ error }}</div>
                                         {% endfor %}
                                     {% endif %}
                                </div>
                            </div>

                            <!-- Photos -->
                            <div class="form-section">
                                <h5 class="section-title"><i class="fas fa-camera me-2"></i>Photos</h5>

                                <!-- Photo de profil -->
                                <div class="row g-3 mb-4">
                                    <div class="col-md-4">
                                        <div class="current-photo-container">
                                            <h6 class="text-muted mb-2">Photo actuelle</h6>
                                            {% if user.profile.profile_picture %}
                                            <img
                                                src="{{ user.profile.profile_picture.url }}"
                                                alt="Photo de profil actuelle"
                                                class="current-profile-pic"
                                            />
                                            {% else %}
                                            <div
                                                class="current-profile-pic bg-secondary d-flex align-items-center justify-content-center text-white fw-bold"
                                            >
                                                {{ user.first_name|first|upper }}{{ user.last_name|first|upper }}
                                            </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="col-md-8">
                                        <label for="{{ form.profile_picture.id_for_label }}" class="form-label"
                                            >Nouvelle photo de profil</label
                                        >
                                        <div class="input-group">
                                            <input
                                                type="text"
                                                class="form-control"
                                                placeholder="Aucun fichier sélectionné"
                                                readonly
                                                id="profile-picture-text"
                                            />
                                            <button
                                                class="btn btn-outline-secondary"
                                                type="button"
                                                onclick="document.getElementById('{{ form.profile_picture.id_for_label }}').click()"
                                            >
                                                <i class="fas fa-upload me-1"></i>Parcourir
                                            </button>
                                        </div>
                                        {{ form.profile_picture }}
                                        {% if form.profile_picture.errors %}
                                            {% for error in form.profile_picture.errors %}
                                                <div class="text-danger small mt-1">{{ error }}</div>
                                            {% endfor %}
                                        {% endif %}
                                        <div class="form-text">Format recommandé : JPG, PNG. Taille max : 5MB</div>

                                        <!-- Prévisualisation de la nouvelle photo -->
                                        <div id="profile-preview" class="mt-3" style="display: none">
                                            <h6 class="text-muted mb-2">Aperçu</h6>
                                            <img
                                                id="profile-preview-img"
                                                src=""
                                                alt="Aperçu"
                                                class="preview-profile-pic"
                                            />
                                        </div>
                                    </div>
                                </div>

                                <!-- Photo de couverture -->
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <div class="current-photo-container">
                                            <h6 class="text-muted mb-2">Photo actuelle</h6>
                                            {% if user.profile.cover_picture %}
                                            <img
                                                src="{{ user.profile.cover_picture.url }}"
                                                alt="Photo de couverture actuelle"
                                                class="current-cover-pic"
                                            />
                                            {% else %}
                                            <div
                                                class="current-cover-pic bg-secondary d-flex align-items-center justify-content-center text-white"
                                            >
                                                <i class="fas fa-image fa-2x"></i>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="col-md-8">
                                        <label for="{{ form.cover_picture.id_for_label }}" class="form-label"
                                            >Nouvelle photo de couverture</label
                                        >
                                        <div class="input-group">
                                            <input
                                                type="text"
                                                class="form-control"
                                                placeholder="Aucun fichier sélectionné"
                                                readonly
                                                id="cover-picture-text"
                                            />
                                            <button
                                                class="btn btn-outline-secondary"
                                                type="button"
                                                onclick="document.getElementById('{{ form.cover_picture.id_for_label }}').click()"
                                            >
                                                <i class="fas fa-upload me-1"></i>Parcourir
                                            </button>
                                        </div>
                                        {{ form.cover_picture }}
                                        {% if form.cover_picture.errors %}
                                            {% for error in form.cover_picture.errors %}
                                                <div class="text-danger small mt-1">{{ error }}</div>
                                            {% endfor %}
                                        {% endif %}
                                        <div class="form-text">Format recommandé : JPG, PNG. Taille max : 5MB</div>

                                        <!-- Prévisualisation de la nouvelle photo -->
                                        <div id="cover-preview" class="mt-3" style="display: none">
                                            <h6 class="text-muted mb-2">Aperçu</h6>
                                            <img id="cover-preview-img" src="" alt="Aperçu" class="preview-cover-pic" />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Informations professionnelles -->
                            <div class="form-section">
                                <h5 class="section-title">
                                    <i class="fas fa-briefcase me-2"></i>Informations professionnelles
                                </h5>

                                <div class="form-floating mb-3">
                                    {{ form.bio }}
                                    <label for="{{ form.bio.id_for_label }}">Bio</label>
                                    {% if form.bio.errors %} {% for error in form.bio.errors %}
                                        <div class="text-danger small mt-1">{{ error }}</div>
                                    {% endfor %} {% endif %}
                                </div>
                            </div>

                            <!-- Boutons d'action -->
                            <div class="d-flex justify-content-between align-items-center">
                                <a href="{% url 'posts:dashboard' %}" class="btn btn-outline-secondary">
                                    <i class="fas fa-arrow-left me-2"></i>Retour au tableau de bord
                                </a>
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-save me-2"></i>Enregistrer les modifications
                                </button>
                            </div>
                        </form>

                        <!-- Zone de danger -->
                        <div class="alert alert-danger border-danger mt-4">
                            <h5 class="alert-heading">
                                <i class="fas fa-exclamation-triangle me-2"></i>Zone de danger
                            </h5>
                            <p class="mb-3">
                                La suppression de votre compte est irréversible. Toutes vos données seront
                                définitivement supprimées.
                            </p>
                            <button
                                type="button"
                                class="btn btn-danger btn-lg"
                                data-bs-toggle="modal"
                                data-bs-target="#deleteAccountModal"
                            >
                                <i class="fas fa-trash me-2"></i>Supprimer mon compte
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de confirmation de suppression -->
<div
    class="modal fade"
    id="deleteAccountModal"
    tabindex="-1"
    aria-labelledby="deleteAccountModalLabel"
    aria-hidden="true"
>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteAccountModalLabel">
                    <i class="fas fa-exclamation-triangle me-2"></i>Confirmer la suppression
                </h5>
                <button
                    type="button"
                    class="btn-close btn-close-white"
                    data-bs-dismiss="modal"
                    aria-label="Close"
                ></button>
            </div>
            <div class="modal-body">
                <p class="mb-3"><strong>Attention !</strong> Cette action est irréversible.</p>
                <p class="mb-3">En supprimant votre compte, vous perdrez définitivement :</p>
                <ul class="mb-3">
                    <li>Tous vos posts et commentaires</li>
                    <li>Vos connexions et messages</li>
                    <li>Votre profil et vos informations</li>
                    <li>Accès à votre compte</li>
                </ul>
                <p class="text-danger">
                    <strong>Êtes-vous sûr de vouloir continuer ?</strong>
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Annuler
                </button>
                <form method="post" action="{% url 'accounts:delete_account' %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash me-2"></i>Oui, supprimer mon compte
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript pour la prévisualisation des photos -->
<script>
    // Prévisualisation de la photo de profil
    document.getElementById("{{ form.profile_picture.id_for_label }}").addEventListener("change", function (e) {
        const file = e.target.files[0];
        const preview = document.getElementById("profile-preview");
        const previewImg = document.getElementById("profile-preview-img");
        const textInput = document.getElementById("profile-picture-text");

        if (file) {
            textInput.value = file.name;
            const reader = new FileReader();
            reader.onload = function (e) {
                previewImg.src = e.target.result;
                preview.style.display = "block";
            };
            reader.readAsDataURL(file);
        } else {
            textInput.value = "";
            preview.style.display = "none";
        }
    });

    // Prévisualisation de la photo de couverture
    document.getElementById("{{ form.cover_picture.id_for_label }}").addEventListener("change", function (e) {
        const file = e.target.files[0];
        const preview = document.getElementById("cover-preview");
        const previewImg = document.getElementById("cover-preview-img");
        const textInput = document.getElementById("cover-picture-text");

        if (file) {
            textInput.value = file.name;
            const reader = new FileReader();
            reader.onload = function (e) {
                previewImg.src = e.target.result;
                preview.style.display = "block";
            };
            reader.readAsDataURL(file);
        } else {
            textInput.value = "";
            preview.style.display = "none";
        }
    });
</script>
{% endblock %}
